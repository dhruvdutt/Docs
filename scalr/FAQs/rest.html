<html><head><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}</style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width">

  <title>Appbase Documentation</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">

  <script async="" src="http://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="../../bower_components/docbase/scripts/polyfill.js"></script>
  <!-- Flatdoc -->
  <script type="text/javascript" src="../../bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/legacy.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/flatdoc.js"></script>

  <!-- Flatdoc theme -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/flatdoc/theme-white/style.css">
  <script type="text/javascript" src="../../bower_components/docbase/scripts/flatdoc-theme.js"></script>

  <!-- DocBase -->
  <script type="text/javascript" src="../../bower_components/angular/angular.js"></script>
  <script type="text/javascript" src="../../bower_components/angular-route/angular-route.js"></script>
  <script type="text/javascript" src="../../bower_components/js-schema/js-schema.min.js"></script>

  <script type="text/javascript" src="../../bower_components/docbase/scripts/docbase.js"></script>
  <script src="../../bower_components/google-code-prettify/bin/prettify.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../../bower_components/google-code-prettify/bin/prettify.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/docbase/styles/main.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/components-font-awesome/css/font-awesome.min.css">
  

  <!-- Custom -->
  <link rel="stylesheet" type="text/css" href="../../styles/docs.css">

</head>
<body role="flatdoc" class="no-literate big-h3">
  <!--[if lt IE 10]>
     <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <!-- ngView:  --><div ng-view="" class="ng-scope"><!-- ngInclude: 'html/navbar.html' --><nav class="navbar navbar-default navbar-fixed-top ng-scope" ng-include="'html/navbar.html'"><div class="container-fluid ng-scope">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a id="docs-appbase-logo" class="navbar-brand" href="http://docs.appbase.io">
      <img src="../../images/logo.svg">
    </a>
  </div>

  <div class="collapse navbar-collapse" id="navbar-collapse">
    <ul class="nav navbar-nav">
      <!-- ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/FAQs" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/FAQs">FAQs</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/jsapi.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/jsapi.html>JS API</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/rest.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/rest.html>REST</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/concepts" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/concepts">Concepts</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/datamodel.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/datamodel.html>Data Model</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/intro.html>Intro</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/javascript" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/javascript">Javascript</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/api-reference.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/api-reference.html>JS API Reference</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/javascript-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/javascript-intro.html>JS Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/nodejs-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/nodejs-intro.html>Node Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/rest" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/rest">REST</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/rest/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/rest/intro.html>Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] -->
    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
           <span ng-bind="currentVersion" class="ng-binding">scalr</span> <span class="caret"></span>
        </a>
        <ul class="dropdown-menu version-switcher" role="menu">
          <!-- ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="version" class="ng-binding" href=../../scalr/concepts/intro.html>scalr</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v2.0/concepts/datamodel.html ng-bind="version" class="ng-binding" href=../../v2.0/concepts/datamodel.html>v2.0</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v3.0/changelog/changelog.html ng-bind="version" class="ng-binding" href=../../v3.0/changelog/changelog.html>v3.0</a>
          </li><!-- end ngRepeat: version in versions -->
        </ul>
      </li>
      <li class="github-star">
        <iframe src="https://ghbtns.com/github-btn.html?user=appbaseio&amp;repo=Docs&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </li>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</nav>
<div role="flatdoc" class="content-root ng-scope">
  <div class="menubar fixed">
    <div class="menu section" role="flatdoc-menu"><ul><li id="root-item" class="level-0"><ul class="level-1" id="root-list"><li id="how-to-item" class="level-1"><a id="how-to-link" href="../../scalr/FAQs/rest.html#how-to" class="level-1" pref="#how-to">How to</a><ul class="level-2" id="how-to-list"><li id="how-to-update-mapping-without-losing-data-item" class="level-2"><a id="how-to-update-mapping-without-losing-data-link" href="../../scalr/FAQs/rest.html#how-to-update-mapping-without-losing-data" class="level-2" pref="#how-to-update-mapping-without-losing-data">Update mapping without losing data</a></li></ul></li></ul></li></ul></div>
  </div>
  <div role="flatdoc-content" class="content"><h1 id="how-to">How to</h1><h2 id="how-to-update-mapping-without-losing-data">Update mapping without losing data</h2><p>We are often asked to update the mapping for a particular field. A mapping is assigned once the data is indexed. Here’s a short gist on how mappings work:</p><p>In order to make your data searchable, your database needs to know what type of data each field contains and how it should be indexed. If you switch a field type from e.g. a string to a date, all of the data for that field that you already have indexed cannot be used because of the datatype mismatch. In such situations, you need to reindex that field.</p><blockquote>
<p>This applies not just to Appbase (or Elasticsearch / Lucene - the datastore used by Appbase), but to any database that uses indices for searching. And if it isn’t using indices then it is sacrificing speed for flexibility.</p>
</blockquote><p>There is one situation where re-indexing is not required: when adding a field, as a previous mapping for the field didn’t exist and Appbase can infer the field datatype when it’s indexed for the first time.</p><p>Since updating mapping =&gt; reindexing data, let’s take a look at that.</p><p><strong>Reindexing your data</strong><br>The process for reindexing your data is quite simple. First, create a new index with the new mapping and settings:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPUT https</span><span class="pun">:</span><span class="com">//$user:$pass@scalr.api.appbase.io/new_app/new_type -d '</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="str">"new_type"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">...</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> mapping definition </span><span class="pun">...}</span><span class="pln">
</span><span class="pun">}</span><span class="str">'</span></code></pre><p>Then, pull the documents in from your old index, using a scrolled search and index them into the new index using the bulk API. Many of the client APIs provide a reindex() method which will do all of this for you. Once you are done, you can delete the old index.</p><p>Note: make sure that you include search_type=scan in your search request. This disables sorting and makes “deep paging” efficient.</p><p>The problem with this approach is that the index name changes, which means that you need to change your application to use the new index name</p><p><strong>Reindexing your data with zero downtime</strong><br>Index aliases give us the flexibility to reindex data in the background, making the change completely transparent to our application. An alias is like a symbolic link which can point to one or more real indices.</p><p>The typical workflow is as follows. First, create an index, appending a version or timestamp to the name:</p><p>  curl -XPUT localhost:9200/my_index_v1 -d ‘
  { 
        … mappings … 
    }’</p><p>Create an alias which points to the index:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPOST localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">_aliases </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{
    "actions": [
        { "add": {
            "alias": "my_index",
            "index": "my_index_v1"
        }}
    ]
}'</span></code></pre><p>Now your application can speak to my_index as if it were a real index.</p><p>When you need to reindex your data, you can create a new index, appending a new version number:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPUT localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">my_index_v2 </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{ 
    ... mappings ...
}'</span></code></pre><p>Reindex data from my_index_v1 to the new my_index_v2, then change the myindex alias to point to the new index, in a single atomic step:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPOST localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">_aliases </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{
    "actions": [
        { "remove": {
            "alias": "my_index",
            "index": "my_index_v1"
        }},
        { "add": {
            "alias": "my_index",
            "index": "my_index_v2"
        }}
    ]
}'</span></code></pre><p>And finally, delete the old index:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XDELETE localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">my_index_v1</span></code></pre><p>You have successfully reindexed all of your data in the background without any downtime. Your application is blissfully unaware that the index has changed.</p><p>Reference: <a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime">Elastic Search blog</a></p></div>
  <a class="edit" ng-href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/rest.md" target="_blank" href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/rest.md">
    <span class="fa fa-pencil"> Edit</span>
  </a>
</div></div>
  <script type="text/javascript" src="../../scripts/analytics.js"></script>
  <script type="text/javascript" src="../../scripts/main.js"></script>
  <script type="text/javascript" src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</body></html>