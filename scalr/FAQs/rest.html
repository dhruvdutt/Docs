<html><head><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}</style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width">

  <title>Appbase Documentation</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">

  <script async="" src="http://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="../../bower_components/docbase/scripts/polyfill.js"></script>
  <!-- Flatdoc -->
  <script type="text/javascript" src="../../bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/legacy.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/flatdoc.js"></script>

  <!-- Flatdoc theme -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/flatdoc/theme-white/style.css">
  <script type="text/javascript" src="../../bower_components/docbase/scripts/flatdoc-theme.js"></script>

  <!-- DocBase -->
  <script type="text/javascript" src="../../bower_components/angular/angular.js"></script>
  <script type="text/javascript" src="../../bower_components/angular-route/angular-route.js"></script>
  <script type="text/javascript" src="../../bower_components/js-schema/js-schema.min.js"></script>

  <script type="text/javascript" src="../../bower_components/docbase/scripts/docbase.js"></script>
  <script src="../../bower_components/google-code-prettify/bin/prettify.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../../bower_components/google-code-prettify/bin/prettify.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/docbase/styles/main.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/components-font-awesome/css/font-awesome.min.css">
  

  <!-- Custom -->
  <link rel="stylesheet" type="text/css" href="../../styles/docs.css">

</head>
<body role="flatdoc" class="no-literate big-h3">
  <!--[if lt IE 10]>
     <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <!-- ngView:  --><div ng-view="" class="ng-scope"><!-- ngInclude: 'html/navbar.html' --><nav class="navbar navbar-default navbar-fixed-top ng-scope" ng-include="'html/navbar.html'"><div class="container-fluid ng-scope">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a id="docs-appbase-logo" class="navbar-brand" href="http://docs.appbase.io">
      <img src="../../images/logo.svg">
    </a>
  </div>

  <div class="collapse navbar-collapse" id="navbar-collapse">
    <ul class="nav navbar-nav">
      <!-- ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/FAQs" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/FAQs">FAQs</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/jsapi.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/jsapi.html>JS API</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/rest.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/rest.html>REST</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/concepts" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/concepts">Concepts</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/datamodel.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/datamodel.html>Data Model</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/intro.html>Intro</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/javascript" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/javascript">Javascript</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/api-reference.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/api-reference.html>JS API Reference</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/javascript-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/javascript-intro.html>JS Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/nodejs-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/nodejs-intro.html>Node Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/rest" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/rest">REST</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/rest/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/rest/intro.html>Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] -->
    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
           <span ng-bind="currentVersion" class="ng-binding">scalr</span> <span class="caret"></span>
        </a>
        <ul class="dropdown-menu version-switcher" role="menu">
          <!-- ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="version" class="ng-binding" href=../../scalr/concepts/intro.html>scalr</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v2.0/concepts/datamodel.html ng-bind="version" class="ng-binding" href=../../v2.0/concepts/datamodel.html>v2.0</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v3.0/changelog/changelog.html ng-bind="version" class="ng-binding" href=../../v3.0/changelog/changelog.html>v3.0</a>
          </li><!-- end ngRepeat: version in versions -->
        </ul>
      </li>
      <li class="github-star">
        <iframe src="https://ghbtns.com/github-btn.html?user=appbaseio&amp;repo=Docs&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </li>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</nav>
<div role="flatdoc" class="content-root ng-scope">
  <div class="menubar fixed">
    <div class="menu section" role="flatdoc-menu"><ul><li id="root-item" class="level-0"><ul class="level-1" id="root-list"><li id="how-to-item" class="level-1"><a id="how-to-link" href="../../scalr/FAQs/rest.html#how-to" class="level-1" pref="#how-to">How to</a><ul class="level-2" id="how-to-list"><li id="how-to-update-mapping-without-losing-data-item" class="level-2"><a id="how-to-update-mapping-without-losing-data-link" href="../../scalr/FAQs/rest.html#how-to-update-mapping-without-losing-data" class="level-2" pref="#how-to-update-mapping-without-losing-data">Update mapping without losing data</a></li></ul></li></ul></li></ul></div>
  </div>
  <div role="flatdoc-content" class="content"><h1 id="how-to">How to</h1><h2 id="how-to-update-mapping-without-losing-data">Update mapping without losing data</h2><p>Although you can add new types to an index, or add new fields to a type, you can’t add new analyzers or make changes to existing fields. If you were to do so, the data that had already been indexed would be incorrect and your searches would no longer work as expected. Here’s a short gist on how mappings work:</p><p>In order to make your data searchable, your database needs to know what type of data each field contains and how it should be indexed. If you switch a field type from e.g. a string to a date, all of the data for that field that you already have indexed cannot be used because of the datatype mismatch. In such situations, you need to reindex that field.</p><blockquote>
<p>This applies not just to Appbase (or Elasticsearch / Lucene - the datastore used by Appbase), but to any database that uses indices for searching. And if it isn’t using indices then it is sacrificing speed for flexibility.</p>
</blockquote><p>There is one situation where re-indexing is not required: when adding a field, as a previous mapping for the field didn’t exist and Appbase can infer the field datatype when it’s indexed for the first time.</p><p>Since updating mapping =&gt; reindexing data, let’s take a look at that.</p><p><strong>Reindexing your data</strong><br>The process for reindexing your data is quite simple. First, create a new app in appbase and update the new mapping and settings:  </p><pre><code class="prettyprint prettyprinted" style=""><span class="com">//Close the Index</span><span class="pln">
curl </span><span class="pun">-</span><span class="pln">XPOST https</span><span class="pun">:</span><span class="com">//$user:$pass@scalr.api.appbase.io/new_app/_close</span><span class="pln">
</span><span class="com">// Update the Settings</span><span class="pln">
curl </span><span class="pun">-</span><span class="pln">XPUT https</span><span class="pun">:</span><span class="com">//$user:$pass@scalr.api.appbase.io/new_app/_setting -d '</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="pun">...</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> setting definition </span><span class="pun">...</span><span class="pln">  
</span><span class="pun">}</span><span class="str">'
// Open the Index
curl -XPOST https://$user:$pass@scalr.api.appbase.io/new_app/_open    

// Update the Mapping
curl -XPUT https://$user:$pass@scalr.api.appbase.io/new_app/_mapping/new_type -d '</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
     </span><span class="str">"new_type"</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="pun">...</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> mapping definition </span><span class="pun">...</span><span class="pln">    
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="str">'</span></code></pre><p>One of the advantages of the _source field is that you already have the whole document available to you in Elasticsearch itself. You don’t have to rebuild your index from the database, which is usually much slower.</p><p>To reindex all of the documents from the old index efficiently, use <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/scan-scroll.html">scan-and-scroll</a> to retrieve batches of documents from the old index, and the <a href="http://docs.appbase.io/scalr/javascript/api-reference.html#javascript-api-reference-writing-data-bulk">bulk API</a> to push them into the new index.</p><p><strong>Reindexing in Batches</strong><br>You can run multiple reindexing jobs at the same time, but you obviously don’t want their results to overlap. Instead, break a big reindex down into smaller jobs by filtering on a date or timestamp field:  </p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">GET https</span><span class="pun">:</span><span class="com">//$user:$pass@scalr.api.appbase.io/old_app/_search?search_type=scan&amp;scroll=1m</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="str">"query"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="str">"range"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="str">"date"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="str">"gte"</span><span class="pun">:</span><span class="pln">  </span><span class="str">"2015-01-01"</span><span class="pun">,</span><span class="pln">
                </span><span class="str">"lt"</span><span class="pun">:</span><span class="pln">   </span><span class="str">"2015-02-01"</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">},</span><span class="pln">
    </span><span class="str">"size"</span><span class="pun">:</span><span class="pln">  </span><span class="lit">1000</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>If you continue making changes to the old app, you will want to make sure that you include the newly added documents in your new app as well. This can be done by rerunning the reindex process, but again filtering on a date field to match only documents that have been added since the last reindex process started.</p><p>Reference: <a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime">Elastic Search blog</a></p></div>
  <a class="edit" ng-href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/rest.md" target="_blank" href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/rest.md">
    <span class="fa fa-pencil"> Edit</span>
  </a>
</div></div>
  <script type="text/javascript" src="../../scripts/analytics.js"></script>
  <script type="text/javascript" src="../../scripts/main.js"></script>
  <script type="text/javascript" src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</body></html>