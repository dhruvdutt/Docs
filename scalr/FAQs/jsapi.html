<html><head><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}</style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width">

  <title>Appbase Documentation</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">

  <script async="" src="http://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="../../bower_components/docbase/scripts/polyfill.js"></script>
  <!-- Flatdoc -->
  <script type="text/javascript" src="../../bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/legacy.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/flatdoc.js"></script>

  <!-- Flatdoc theme -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/flatdoc/theme-white/style.css">
  <script type="text/javascript" src="../../bower_components/docbase/scripts/flatdoc-theme.js"></script>

  <!-- DocBase -->
  <script type="text/javascript" src="../../bower_components/angular/angular.js"></script>
  <script type="text/javascript" src="../../bower_components/angular-route/angular-route.js"></script>
  <script type="text/javascript" src="../../bower_components/js-schema/js-schema.min.js"></script>

  <script type="text/javascript" src="../../bower_components/docbase/scripts/docbase.js"></script>
  <script src="../../bower_components/google-code-prettify/bin/prettify.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../../bower_components/google-code-prettify/bin/prettify.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/docbase/styles/main.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/components-font-awesome/css/font-awesome.min.css">
  

  <!-- Custom -->
  <link rel="stylesheet" type="text/css" href="../../styles/docs.css">

</head>
<body role="flatdoc" class="no-literate">
  <!--[if lt IE 10]>
     <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <!-- ngView:  --><div ng-view="" class="ng-scope"><!-- ngInclude: 'html/navbar.html' --><nav class="navbar navbar-default navbar-fixed-top ng-scope" ng-include="'html/navbar.html'"><div class="container-fluid ng-scope">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a id="docs-appbase-logo" class="navbar-brand" href="http://docs.appbase.io">
      <img src="../../images/logo.svg">
    </a>
  </div>

  <div class="collapse navbar-collapse" id="navbar-collapse">
    <ul class="nav navbar-nav">
      <!-- ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/FAQs" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/FAQs">FAQs</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/jsapi.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/jsapi.html>JS API</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/rest.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/rest.html>REST</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/concepts" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/concepts">Concepts</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/datamodel.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/datamodel.html>Data Model</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/intro.html>Intro</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/javascript" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/javascript">Javascript</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/api-reference.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/api-reference.html>JS API Reference</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/javascript-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/javascript-intro.html>JS Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/nodejs-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/nodejs-intro.html>Node Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/rest" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/rest">REST</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/rest/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/rest/intro.html>Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] -->
    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
           <span ng-bind="currentVersion" class="ng-binding">scalr</span> <span class="caret"></span>
        </a>
        <ul class="dropdown-menu version-switcher" role="menu">
          <!-- ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="version" class="ng-binding" href=../../scalr/concepts/intro.html>scalr</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v2.0/concepts/datamodel.html ng-bind="version" class="ng-binding" href=../../v2.0/concepts/datamodel.html>v2.0</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v3.0/changelog/changelog.html ng-bind="version" class="ng-binding" href=../../v3.0/changelog/changelog.html>v3.0</a>
          </li><!-- end ngRepeat: version in versions -->
        </ul>
      </li>
      <li class="github-star">
        <iframe src="https://ghbtns.com/github-btn.html?user=appbaseio&amp;repo=Docs&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </li>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</nav>
<div role="flatdoc" class="content-root ng-scope">
  <div class="menubar fixed">
    <div class="menu section" role="flatdoc-menu"><ul><li id="root-item" class="level-0"><ul class="level-1" id="root-list"><li id="how-to-item" class="level-1"><a id="how-to-link" href="../../scalr/FAQs/jsapi.html#how-to" class="level-1" pref="#how-to">How to</a><ul class="level-2" id="how-to-list"><li id="how-to-unsubscribe-from-a-streaming-query-item" class="level-2"><a id="how-to-unsubscribe-from-a-streaming-query-link" href="../../scalr/FAQs/jsapi.html#how-to-unsubscribe-from-a-streaming-query" class="level-2" pref="#how-to-unsubscribe-from-a-streaming-query">Unsubscribe from a streaming query</a></li><li id="how-to-pause-a-streaming-query-item" class="level-2"><a id="how-to-pause-a-streaming-query-link" href="../../scalr/FAQs/jsapi.html#how-to-pause-a-streaming-query" class="level-2" pref="#how-to-pause-a-streaming-query">Pause a streaming query</a></li><li id="how-to-stream-results-of-a-range-query-item" class="level-2"><a id="how-to-stream-results-of-a-range-query-link" href="../../scalr/FAQs/jsapi.html#how-to-stream-results-of-a-range-query" class="level-2" pref="#how-to-stream-results-of-a-range-query">Stream results of a range query</a></li></ul></li></ul></li></ul></div>
  </div>
  <div role="flatdoc-content" class="content"><h1 id="how-to">How to</h1><h2 id="how-to-unsubscribe-from-a-streaming-query">Unsubscribe from a streaming query</h2><p>The JS API methods for the <a href="http://docs.appbase.io/scalr/javascript/api-reference.html#javascript-api-reference-setup-new-appbase"><code>appbaseRef</code></a> object implement a <strong>streams</strong> interface. Let’s see an example:</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="comment"><span class="com">// responseStream implements the streams interface.</span></span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> responseStream </span><span class="pun">=</span><span class="pln"> appbaseRef</span><span class="pun">.</span><span class="pln">searchStream</span><span class="pun">({</span><span class="pln">
    type</span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"tweet"</span></span><span class="pun">,</span><span class="pln">
    body</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        query</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            match_all</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span><span class="pln">

</span><span class="comment"><span class="com">// You can attach a </span><span class="string"><span class="com">'data'</span></span><span class="com"> handler to responseStream and get new events</span></span><span class="pln">
</span><span class="comment"><span class="com">// when documents match the query</span></span><span class="pln">
responseStream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="string"><span class="str">"data"</span></span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
        </span><span class="comment"><span class="com">// handle initial data</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="comment"><span class="com">// handle new updates, one at a time.</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></code></pre><p>Unsubscribing from the <code>responseStream</code> is simple: using <code>stop()</code> method.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">setTimeout</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">()},</span><span class="pln"> </span><span class="number"><span class="lit">10000</span></span><span class="pun">);</span><span class="pln"> </span><span class="comment"><span class="com">// unsubscribes after </span><span class="number"><span class="com">10</span></span><span class="com">s timeout</span></span></code></pre><p><code>Note:</code> The same is true for all other methods (like <code>index()</code>, <code>readStream()</code>) as well, data is returned asynchronously via the ‘data’ event handler.</p><h2 id="how-to-pause-a-streaming-query">Pause a streaming query</h2><p><a href="https://nodejs.org/api/stream.html#stream_readable_pause">Pausing a response stream object</a> prevents new data responses from emitting. The stream can be resumed again via conveniently named <code>responseStream.resume()</code>.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">pause</span><span class="pun">();</span></code></pre><p><code>Note:</code> <strong>pause()</strong> vs <strong>stop()</strong> - pause() merely prevents emitting new ‘data’ event handlers, the response stream object still continues to capture the new events emitted by the searchStream() method. In contrast, stop() unsubscribes from the query and kills the response stream object.</p><h2 id="how-to-stream-results-of-a-range-query">Stream results of a range query</h2><p>Appbase.io implements a streaming interface for the entire <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/query-dsl.html">Query DSL</a> supported by ElasticSearch. So if we can compose a range query, making it return continuous results is easy.</p><p>Let’s say we have a <strong>type</strong> called <em>items</em> which contains items with their corresponding value. An example document inside the <em>items</em> type looks like:</p><pre><code class="lang-json prettyprint prettyprinted" style=""><span class="pun">{</span><span class="pln">
    </span><span class="string"><span class="str">"item"</span></span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"socks"</span></span><span class="pun">,</span><span class="pln">
    </span><span class="string"><span class="str">"value"</span></span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"</span><span class="number"><span class="str">255</span></span><span class="str">"</span></span><span class="pun">,</span><span class="pln">
    </span><span class="string"><span class="str">"visible"</span></span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Composing the query:</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="kwd">var</span><span class="pln"> responseStream </span><span class="pun">=</span><span class="pln"> appbaseRef</span><span class="pun">.</span><span class="pln">searchStream</span><span class="pun">({</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"items"</span></span><span class="pun">,</span><span class="pln">
      body</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          query</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
              range</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                  value</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                      lte</span><span class="pun">:</span><span class="pln"> </span><span class="number"><span class="lit">300</span></span><span class="pun">,</span><span class="pln">
                      gte</span><span class="pun">:</span><span class="pln"> </span><span class="number"><span class="lit">200</span></span><span class="pln">
                  </span><span class="pun">}</span><span class="pln">
              </span><span class="pun">}</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span></code></pre><p>The default state of <code>responseStream</code> object is paused. As soon as attach a data handler to it, it will start streaming the responses.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="string"><span class="str">"data"</span></span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">);</span><span class="pln"> </span><span class="comment"><span class="com">// returns an array of initially matching objects</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">_source</span><span class="pun">);</span><span class="pln">   </span><span class="comment"><span class="com">// a newly inserted document just matched the range query </span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span></code></pre></div>
  <a class="edit" ng-href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/jsapi.md" target="_blank" href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/jsapi.md">
    <span class="fa fa-pencil"> Edit</span>
  </a>
</div></div>
  <script type="text/javascript" src="../../scripts/analytics.js"></script>
  <script type="text/javascript" src="../../scripts/main.js"></script>
  <script type="text/javascript" src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</body></html>