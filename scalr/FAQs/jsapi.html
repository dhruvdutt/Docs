<html><head><style type="text/css">@charset "UTF-8";[ng\:cloak],[ng-cloak],[data-ng-cloak],[x-ng-cloak],.ng-cloak,.x-ng-cloak,.ng-hide:not(.ng-hide-animate){display:none !important;}ng\:form{display:block;}</style>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width">

  <title>Appbase Documentation</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">

  <script async="" src="http://www.google-analytics.com/analytics.js"></script><script type="text/javascript" src="../../bower_components/docbase/scripts/polyfill.js"></script>
  <!-- Flatdoc -->
  <script type="text/javascript" src="../../bower_components/jquery/dist/jquery.min.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/legacy.js"></script>
  <script type="text/javascript" src="../../bower_components/flatdoc/flatdoc.js"></script>

  <!-- Flatdoc theme -->
  <link rel="stylesheet" type="text/css" href="../../bower_components/flatdoc/theme-white/style.css">
  <script type="text/javascript" src="../../bower_components/docbase/scripts/flatdoc-theme.js"></script>

  <!-- DocBase -->
  <script type="text/javascript" src="../../bower_components/angular/angular.js"></script>
  <script type="text/javascript" src="../../bower_components/angular-route/angular-route.js"></script>
  <script type="text/javascript" src="../../bower_components/js-schema/js-schema.min.js"></script>

  <script type="text/javascript" src="../../bower_components/docbase/scripts/docbase.js"></script>
  <script src="../../bower_components/google-code-prettify/bin/prettify.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../../bower_components/google-code-prettify/bin/prettify.min.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/docbase/styles/main.css">
  <link rel="stylesheet" type="text/css" href="../../bower_components/components-font-awesome/css/font-awesome.min.css">
  

  <!-- Custom -->
  <link rel="stylesheet" type="text/css" href="../../styles/docs.css">

</head>
<body role="flatdoc" class="no-literate">
  <!--[if lt IE 10]>
     <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
  <![endif]-->

  <!-- ngView:  --><div ng-view="" class="ng-scope"><!-- ngInclude: 'html/navbar.html' --><nav class="navbar navbar-default navbar-fixed-top ng-scope" ng-include="'html/navbar.html'"><div class="container-fluid ng-scope">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse">
      <span class="sr-only">Toggle navigation</span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a id="docs-appbase-logo" class="navbar-brand" href="http://docs.appbase.io">
      <img src="../../images/logo.svg">
    </a>
  </div>

  <div class="collapse navbar-collapse" id="navbar-collapse">
    <ul class="nav navbar-nav">
      <!-- ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/FAQs" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/FAQs">FAQs</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/FAQs/jsapi.html ng-bind="file.label" class="ng-binding" href=../../scalr/FAQs/jsapi.html>JS API</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/concepts" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/concepts">Concepts</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/datamodel.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/datamodel.html>Data Model</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/concepts/intro.html>Intro</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/javascript" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/javascript">Javascript</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/api-reference.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/api-reference.html>JS API Reference</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/javascript-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/javascript-intro.html>JS Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/javascript/nodejs-intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/javascript/nodejs-intro.html>Node Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] --><li class="dropdown ng-scope" ng-repeat="folder in map[currentVersion]">
        <a ng-href="#/scalr/rest" class="dropdown-toggle ng-binding" data-toggle="dropdown" role="button" aria-expanded="false" ng-bind="folder.label" href="#/scalr/rest">REST</a>
        <ul class="dropdown-menu">
          <!-- ngRepeat: file in folder.files --><li ng-repeat="file in folder.files" class="ng-scope">
            <a ng-href=../../scalr/rest/intro.html ng-bind="file.label" class="ng-binding" href=../../scalr/rest/intro.html>Quick Start</a>
          </li><!-- end ngRepeat: file in folder.files -->
        </ul>
      </li><!-- end ngRepeat: folder in map[currentVersion] -->
    </ul>

    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
           <span ng-bind="currentVersion" class="ng-binding">scalr</span> <span class="caret"></span>
        </a>
        <ul class="dropdown-menu version-switcher" role="menu">
          <!-- ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../scalr/concepts/intro.html ng-bind="version" class="ng-binding" href=../../scalr/concepts/intro.html>scalr</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v2.0/concepts/datamodel.html ng-bind="version" class="ng-binding" href=../../v2.0/concepts/datamodel.html>v2.0</a>
          </li><!-- end ngRepeat: version in versions --><li ng-repeat="version in versions" class="ng-scope">
            <a ng-href=../../v3.0/changelog/changelog.html ng-bind="version" class="ng-binding" href=../../v3.0/changelog/changelog.html>v3.0</a>
          </li><!-- end ngRepeat: version in versions -->
        </ul>
      </li>
      <li class="github-star">
        <iframe src="https://ghbtns.com/github-btn.html?user=appbaseio&amp;repo=Docs&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>
      </li>
    </ul>
  </div><!-- /.navbar-collapse -->
</div><!-- /.container-fluid -->
</nav>
<div role="flatdoc" class="content-root ng-scope">
  <div class="menubar fixed">
    <div class="menu section" role="flatdoc-menu"><ul><li id="root-item" class="level-0"><ul class="level-1" id="root-list"><li id="how-to-item" class="level-1"><a id="how-to-link" href="../../scalr/FAQs/jsapi.html#how-to" class="level-1" pref="#how-to">How to</a><ul class="level-2" id="how-to-list"><li id="how-to-unsubscribe-from-a-streaming-query-item" class="level-2"><a id="how-to-unsubscribe-from-a-streaming-query-link" href="../../scalr/FAQs/jsapi.html#how-to-unsubscribe-from-a-streaming-query" class="level-2" pref="#how-to-unsubscribe-from-a-streaming-query">Unsubscribe from a streaming query</a></li><li id="how-to-pause-a-streaming-query-item" class="level-2"><a id="how-to-pause-a-streaming-query-link" href="../../scalr/FAQs/jsapi.html#how-to-pause-a-streaming-query" class="level-2" pref="#how-to-pause-a-streaming-query">Pause a streaming query</a></li><li id="how-to-stream-results-of-a-range-query-item" class="level-2"><a id="how-to-stream-results-of-a-range-query-link" href="../../scalr/FAQs/jsapi.html#how-to-stream-results-of-a-range-query" class="level-2" pref="#how-to-stream-results-of-a-range-query">Stream results of a range query</a></li><li id="how-to-update-mapping-without-losing-data-item" class="level-2"><a id="how-to-update-mapping-without-losing-data-link" href="../../scalr/FAQs/jsapi.html#how-to-update-mapping-without-losing-data" class="level-2" pref="#how-to-update-mapping-without-losing-data">Update mapping without losing data</a><ul class="level-3" id="how-to-update-mapping-without-losing-data-list"><li id="how-to-update-mapping-without-losing-data-althought-adding-a-new-field-does-not-require-you-to-reindex-your-database-item" class="level-3"><a id="how-to-update-mapping-without-losing-data-althought-adding-a-new-field-does-not-require-you-to-reindex-your-database-link" href="../../scalr/FAQs/jsapi.html#how-to-update-mapping-without-losing-data-althought-adding-a-new-field-does-not-require-you-to-reindex-your-database" class="level-3" pref="#how-to-update-mapping-without-losing-data-althought-adding-a-new-field-does-not-require-you-to-reindex-your-database">Althought adding a new field does not require you to reindex your database.</a></li><li id="how-to-update-mapping-without-losing-data-reindexing-your-data-item" class="level-3"><a id="how-to-update-mapping-without-losing-data-reindexing-your-data-link" href="../../scalr/FAQs/jsapi.html#how-to-update-mapping-without-losing-data-reindexing-your-data" class="level-3" pref="#how-to-update-mapping-without-losing-data-reindexing-your-data">Reindexing your data</a></li><li id="how-to-update-mapping-without-losing-data-reindexing-your-data-with-zero-downtime-item" class="level-3"><a id="how-to-update-mapping-without-losing-data-reindexing-your-data-with-zero-downtime-link" href="../../scalr/FAQs/jsapi.html#how-to-update-mapping-without-losing-data-reindexing-your-data-with-zero-downtime" class="level-3" pref="#how-to-update-mapping-without-losing-data-reindexing-your-data-with-zero-downtime">Reindexing your data with zero downtime</a></li></ul></li></ul></li></ul></li></ul></div>
  </div>
  <div role="flatdoc-content" class="content"><h1 id="how-to">How to</h1><h2 id="how-to-unsubscribe-from-a-streaming-query">Unsubscribe from a streaming query</h2><p>The JS API methods for the <a href="http://docs.appbase.io/scalr/javascript/api-reference.html#javascript-api-reference-setup-new-appbase"><code>appbaseRef</code></a> object implement a <strong>streams</strong> interface. Let’s see an example:</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="comment"><span class="com">// responseStream implements the streams interface.</span></span><span class="pln">
</span><span class="kwd">var</span><span class="pln"> responseStream </span><span class="pun">=</span><span class="pln"> appbaseRef</span><span class="pun">.</span><span class="pln">searchStream</span><span class="pun">({</span><span class="pln">
    type</span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"tweet"</span></span><span class="pun">,</span><span class="pln">
    body</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        query</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            match_all</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span><span class="pln">

</span><span class="comment"><span class="com">// You can attach a </span><span class="string"><span class="com">'data'</span></span><span class="com"> handler to responseStream and get new events</span></span><span class="pln">
</span><span class="comment"><span class="com">// when documents match the query</span></span><span class="pln">
responseStream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="string"><span class="str">"data"</span></span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> 
        </span><span class="comment"><span class="com">// handle initial data</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="comment"><span class="com">// handle new updates, one at a time.</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">});</span></code></pre><p>Unsubscribing from the <code>responseStream</code> is simple: using <code>stop()</code> method.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">setTimeout</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">stop</span><span class="pun">()},</span><span class="pln"> </span><span class="number"><span class="lit">10000</span></span><span class="pun">);</span><span class="pln"> </span><span class="comment"><span class="com">// unsubscribes after </span><span class="number"><span class="com">10</span></span><span class="com">s timeout</span></span></code></pre><p><code>Note:</code> The same is true for all other methods (like <code>index()</code>, <code>readStream()</code>) as well, data is returned asynchronously via the ‘data’ event handler.</p><h2 id="how-to-pause-a-streaming-query">Pause a streaming query</h2><p><a href="https://nodejs.org/api/stream.html#stream_readable_pause">Pausing a response stream object</a> prevents new data responses from emitting. The stream can be resumed again via conveniently named <code>responseStream.resume()</code>.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">pause</span><span class="pun">();</span></code></pre><p><code>Note:</code> <strong>pause()</strong> vs <strong>stop()</strong> - pause() merely prevents emitting new ‘data’ event handlers, the response stream object still continues to capture the new events emitted by the searchStream() method. In contrast, stop() unsubscribes from the query and kills the response stream object.</p><h2 id="how-to-stream-results-of-a-range-query">Stream results of a range query</h2><p>Appbase.io implements a streaming interface for the entire <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/query-dsl.html">Query DSL</a> supported by ElasticSearch. So if we can compose a range query, making it return continuous results is easy.</p><p>Let’s say we have a <strong>type</strong> called <em>items</em> which contains items with their corresponding value. An example document inside the <em>items</em> type looks like:</p><pre><code class="lang-json prettyprint prettyprinted" style=""><span class="pun">{</span><span class="pln">
    </span><span class="string"><span class="str">"item"</span></span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"socks"</span></span><span class="pun">,</span><span class="pln">
    </span><span class="string"><span class="str">"value"</span></span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"</span><span class="number"><span class="str">255</span></span><span class="str">"</span></span><span class="pun">,</span><span class="pln">
    </span><span class="string"><span class="str">"visible"</span></span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pln">
</span><span class="pun">}</span></code></pre><p>Composing the query:</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="kwd">var</span><span class="pln"> responseStream </span><span class="pun">=</span><span class="pln"> appbaseRef</span><span class="pun">.</span><span class="pln">searchStream</span><span class="pun">({</span><span class="pln">
      type</span><span class="pun">:</span><span class="pln"> </span><span class="string"><span class="str">"items"</span></span><span class="pun">,</span><span class="pln">
      body</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
          query</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
              range</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                  value</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                      lte</span><span class="pun">:</span><span class="pln"> </span><span class="number"><span class="lit">300</span></span><span class="pun">,</span><span class="pln">
                      gte</span><span class="pun">:</span><span class="pln"> </span><span class="number"><span class="lit">200</span></span><span class="pln">
                  </span><span class="pun">}</span><span class="pln">
              </span><span class="pun">}</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span></code></pre><p>The default state of <code>responseStream</code> object is paused. As soon as attach a data handler to it, it will start streaming the responses.</p><pre><code class="lang-js prettyprint prettyprinted" style=""><span class="pln">responseStream</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="string"><span class="str">"data"</span></span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">res</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">.</span><span class="pln">hits</span><span class="pun">);</span><span class="pln"> </span><span class="comment"><span class="com">// returns an array of initially matching objects</span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">res</span><span class="pun">.</span><span class="pln">_source</span><span class="pun">);</span><span class="pln">   </span><span class="comment"><span class="com">// a newly inserted document just matched the range query </span></span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">})</span></code></pre><h2 id="how-to-update-mapping-without-losing-data">Update mapping without losing data</h2><p>We are often asked to update a mapping of a field. But once the data is indexed in to ES it cannot be modified. Appbase is built on Elastic search. According to elastic search doc <a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime">here</a>:</p><pre><code class="prettyprint prettyprinted" style=""><span class="typ">You</span><span class="pln"> can only find that which </span><span class="kwd">is</span><span class="pln"> stored </span><span class="kwd">in</span><span class="pln"> your index</span><span class="pun">.</span><span class="pln"> </span><span class="typ">In</span><span class="pln"> order to make your data searchable</span><span class="pun">,</span><span class="pln"> your database needs to know what type of data each field contains </span><span class="kwd">and</span><span class="pln"> how it should be indexed</span><span class="pun">.</span><span class="pln"> </span><span class="typ">If</span><span class="pln"> you </span><span class="kwd">switch</span><span class="pln"> a field type </span><span class="kwd">from</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">g</span><span class="pun">.</span><span class="pln"> a </span><span class="kwd">string</span><span class="pln"> to a date</span><span class="pun">,</span><span class="pln"> all of the data </span><span class="kwd">for</span><span class="pln"> that field that you already have indexed becomes useless</span><span class="pun">.</span><span class="pln"> </span><span class="typ">One</span><span class="pln"> way </span><span class="kwd">or</span><span class="pln"> another</span><span class="pun">,</span><span class="pln"> you need to reindex that field</span><span class="pun">.</span><span class="pln">

</span><span class="typ">This</span><span class="pln"> applies </span><span class="kwd">not</span><span class="pln"> just to </span><span class="typ">Elasticsearch</span><span class="pun">,</span><span class="pln"> but to any database that uses indices </span><span class="kwd">for</span><span class="pln"> searching</span><span class="pun">.</span><span class="pln"> </span><span class="typ">And</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> it isn</span><span class="str">'t using indices then it is sacrificing speed for flexibility.</span></code></pre><h3 id="how-to-update-mapping-without-losing-data-althought-adding-a-new-field-does-not-require-you-to-reindex-your-database">Althought adding a new field does not require you to reindex your database.</h3><pre><code class="prettyprint prettyprinted" style=""><span class="pln">A segment only contains indices </span><span class="kwd">for</span><span class="pln"> fields that actually exist </span><span class="kwd">in</span><span class="pln"> the documents </span><span class="kwd">for</span><span class="pln"> that segment</span><span class="pun">.</span><span class="pln"> </span><span class="typ">This</span><span class="pln"> means that you can add </span><span class="kwd">new</span><span class="pln"> fields </span><span class="kwd">for</span><span class="pln"> free</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">using</span><span class="pln"> the put_mapping API</span><span class="pun">.</span><span class="pln"> </span><span class="typ">There</span><span class="pln"> </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">no</span><span class="pln"> need to reindex</span><span class="pun">.</span></code></pre><h3 id="how-to-update-mapping-without-losing-data-reindexing-your-data">Reindexing your data</h3><p>The process for reindexing your data is quite simple. First, create a new index with the new mapping and settings:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPUT localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">new_index </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{
    "mappings": {
        "my_type": { ... new mapping definition ...}
    }
}'</span></code></pre><p>Then, pull the documents in from your old index, using a scrolled search and index them into the new index using the bulk API. Many of the client APIs provide a reindex() method which will do all of this for you. Once you are done, you can delete the old index.</p><p>Note: make sure that you include search_type=scan in your search request. This disables sorting and makes “deep paging” efficient.</p><p>The problem with this approach is that the index name changes, which means that you need to change your application to use the new index name</p><h3 id="how-to-update-mapping-without-losing-data-reindexing-your-data-with-zero-downtime">Reindexing your data with zero downtime</h3><p>Index aliases give us the flexibility to reindex data in the background, making the change completely transparent to our application. An alias is like a symbolic link which can point to one or more real indices.</p><p>The typical workflow is as follows. First, create an index, appending a version or timestamp to the name:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPUT localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">my_index_v1 </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{ 
    ... mappings ... 
}'</span></code></pre><p>Create an alias which points to the index:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPOST localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">_aliases </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{
    "actions": [
        { "add": {
            "alias": "my_index",
            "index": "my_index_v1"
        }}
    ]
}'</span></code></pre><p>Now your application can speak to my_index as if it were a real index.</p><p>When you need to reindex your data, you can create a new index, appending a new version number:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPUT localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">my_index_v2 </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{ 
    ... mappings ...
}'</span></code></pre><p>Reindex data from my_index_v1 to the new my_index_v2, then change the myindex alias to point to the new index, in a single atomic step:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XPOST localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">_aliases </span><span class="pun">-</span><span class="pln">d </span><span class="str">'
{
    "actions": [
        { "remove": {
            "alias": "my_index",
            "index": "my_index_v1"
        }},
        { "add": {
            "alias": "my_index",
            "index": "my_index_v2"
        }}
    ]
}'</span></code></pre><p>And finally, delete the old index:</p><pre><code class="prettyprint prettyprinted" style=""><span class="pln">curl </span><span class="pun">-</span><span class="pln">XDELETE localhost</span><span class="pun">:</span><span class="lit">9200</span><span class="pun">/</span><span class="pln">my_index_v1</span></code></pre><p>You have successfully reindexed all of your data in the background without any downtime. Your application is blissfully unaware that the index has changed.</p><p>Reference: <a href="https://www.elastic.co/blog/changing-mapping-with-zero-downtime">Elastic Search blog</a></p></div>
  <a class="edit" ng-href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/jsapi.md" target="_blank" href="https://github.com/appbaseio/Docs/tree/master/src/scalr/FAQs/jsapi.md">
    <span class="fa fa-pencil"> Edit</span>
  </a>
</div></div>
  <script type="text/javascript" src="../../scripts/analytics.js"></script>
  <script type="text/javascript" src="../../scripts/main.js"></script>
  <script type="text/javascript" src="../../bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

</body></html>